---
import Layout from "../layouts/Layout.astro";
import {getColor, getSeasonColor} from "../utils/constants";

const files = import.meta.glob('../content/talks/*.json', {eager: true});

const continent = {
    'Europe': 'Europe, the Middle East & Africa',
    'Asia': 'Asia, Australia & Oceania',
    'America': 'North America & South America'
}

const tableData = Object.values(files).map((file) => {
    const data = file.default;
    const presenters = Array.isArray(data.presenter) ? data.presenter : [data.presenter];

    return {
        names: presenters.map(p => p.name),
        affiliations: presenters.map(p => p.affiliation),
        title: data.title,
        datePrague: data.datePrague,
        continents: [...new Set(presenters.map(p => p.continent))],
        parsedContinents: [...new Set(presenters.map(p => continent[p.continent]))],
        keywords: data.keywords
    };
}).sort((a, b) => {
    return new Date(b.datePrague) - new Date(a.datePrague);
});

const columns = ["Name", "Affiliation", "Talk Title", "Date", "Continent", "Keywords"];
---
<Layout title="Speakers List">
    <div class="mx-auto px-6 py-5 flex flex-col h-[calc(100vh-3rem)]">
        <h1 class="text-2xl font-bold mb-2">Speaker List</h1>
        <a href="/" class="text-blue-500 hover:underline block mb-4">&larr; Home</a>

        <div class="overflow-auto rounded-lg border border-gray-200 shadow-sm flex-1 min-h-0">
            <table class="w-full text-sm text-left text-gray-500">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50 sticky top-0 z-10 shadow-sm">
                <tr>
                    {columns.map((column, index) => (
                            <th class="px-2 py-2" key={index}>{column}</th>
                    ))}
                </tr>
                </thead>
                <tbody class="text-xs">
                {tableData.map((data, rIndex) =>
                    (
                            <tr key={`row#${rIndex}`} class="bg-white hover:bg-gray-200 ">
                                <td class={`px-2 py-1 font-medium`}> <!-- ${getSeasonColor(data.datePrague)} -->
                                    {data.names.map((name, i) => <div key={i}>{name}</div>)}
                                </td>
                                <td class={`px-2 py-1 font-medium`}>
                                    {data.affiliations.map((affiliation, i) => <div key={i}>{affiliation}</div>)}
                                </td>
                                <td class={`px-2 py-1 font-medium min-w-96`}>
                                    <div class="line-clamp-2 leading-relaxed whitespace-normal" title={data.title}>
                                        {data.title}
                                    </div>
                                </td>
                                <td class={`px-2 py-1 font-medium whitespace-nowrap`}>
                                    {data.datePrague}
                                </td>
                                <td class={`px-2 py-1 font-medium whitespace-nowrap ${getColor(data.continents[0])}`}>
                                    {data.parsedContinents.map((c, i) => <div key={i}>{c}</div>)}
                                </td>
                                <td class={`px-2 py-1 font-medium whitespace-nowrap`}>
                                    {data.keywords}
                                </td>
                            </tr>
                    )
                )}
                </tbody>
            </table>
        </div>
    </div>
</Layout>