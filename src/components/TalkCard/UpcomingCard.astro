---
import PresenterAvatar from "./PresenterAvatar.astro";
import ActionButtons from "./ActionButtons.astro";
import AbstractSection from "./AbstractSection.astro";
import Keywords from "./Keywords.astro";
import InvitedBy from "./InvitedBy.astro";
import TimeZones from "./TimeZones.astro";
import {getBorderClass} from "../../utils/constants";

const {talk} = Astro.props;
const cardId = `talk-card-${talk.datePrague}`;
// Ensure presenters is an array (even if schema transform didn't catch it for some reason, though it should)
const presenters = Array.isArray(talk.presenter) ? talk.presenter : [talk.presenter];
const borderClass = getBorderClass(presenters[0].continent);
---

<article
        class={`bg-white rounded-2xl shadow-md hover:shadow-xl transition-all overflow-hidden border-l-4 snap-start shrink-0 ${borderClass} hover:scale-[1.02]`}
        data-card-id={cardId}
>
    <div class="p-6">
        <div class="flex justify-between items-start gap-4 mb-3">
            <h3 class="text-xl font-bold text-gray-800 leading-tight">
                {talk.title}
            </h3>

            {/* Buttons positioned next to title.
                shrink-0 ensures they don't collapse.
                pt-1 aligns them visually with the text top. */}
            <div class="shrink-0 pt-1">
                <ActionButtons talk={talk} />
                <ActionButtons talk={talk} compact={true} />
            </div>
        </div>

        <AbstractSection abstract={talk.abstract}/>

        <div class="flex flex-col md:flex-row gap-6 mt-4">
            <div class="flex flex-col gap-4 md:w-32 shrink-0">
                {presenters.map((presenter) => (
                    <div class="flex flex-row md:flex-col items-center gap-4 md:gap-2">
                        <PresenterAvatar presenter={presenter} size="large"/>
                        <div class="flex-1 md:flex-none md:text-center">
                            <a
                                    href={presenter.link}
                                    target="_blank"
                                    rel="noreferrer"
                                    class="font-semibold text-gray-800 hover:opacity-80 block leading-tight"
                            >
                                {presenter.name}
                            </a>
                            <p class="text-sm text-gray-500 leading-tight mt-1">{presenter.affiliation}</p>
                        </div>
                    </div>
                ))}
            </div>

            <div class="flex-1">
                <TimeZones times={talk.times}/>
                <Keywords keywords={talk.keywords}/>
                <InvitedBy invitedBy={talk.invitedBy}/>
            </div>
        </div>

        {talk.youtubeEmbed && (
                <div class="mt-6 rounded-xl overflow-hidden shadow-lg">
                    <div class="relative aspect-video">
                        <iframe
                                src={talk.youtubeEmbed}
                                title="YouTube video player"
                                class="absolute inset-0 w-full h-full"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture;"
                                referrerpolicy="strict-origin-when-cross-origin"
                                allowfullscreen
                        />
                    </div>
                </div>
        )}
    </div>
</article>