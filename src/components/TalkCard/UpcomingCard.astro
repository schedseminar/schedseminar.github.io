---
import PresenterAvatar from "./PresenterAvatar.astro";
import AbstractSection from "./AbstractSection.astro";
import Keywords from "./Keywords.astro";
import InvitedBy from "./InvitedBy.astro";
import TimeZones from "./TimeZones.astro";
import { getBorderClass } from "../../utils/constants";

const { talk } = Astro.props;
const cardId = `talk-card-${talk.id}`;
const borderClass = getBorderClass(talk.presenter.continent);
---

<article 
  class={`bg-white rounded-2xl shadow-md hover:shadow-xl transition-all overflow-hidden border-l-4 snap-start shrink-0 ${borderClass} hover:scale-[1.02]`}
  data-card-id={cardId}
>
  <div class="p-6">
    <h3 class="text-xl font-bold text-gray-800 mb-3 leading-tight">{talk.title}</h3>
    
    <AbstractSection abstract={talk.abstract} />

    {(talk.pdf || talk.video) && (
      <div class="flex flex-wrap gap-2 mb-4">
        {talk.pdf && (
          <a href={`/presentations/${talk.pdf}`} download
             class="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white text-sm rounded-lg hover:shadow-lg transition-all">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
            </svg>
            PDF
          </a>
        )}
        {talk.video && (
          <a href={talk.video} download
             class="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-purple-700 text-white text-sm rounded-lg hover:shadow-lg transition-all">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            Video
          </a>
        )}
      </div>
    )}

    <div class="flex flex-col md:flex-row gap-6">
      <div class="flex md:flex-col justify-center items-center gap-4 md:w-32">
        <a href={talk.presenter.link}>
          <PresenterAvatar presenter={talk.presenter} size="large" />
        </a>
        <div class="flex-1 md:flex-none md:text-center">
          <p class="font-semibold text-gray-800">{talk.presenter.name}</p>
          <p class="text-sm text-gray-500">{talk.presenter.affiliation}</p>
        </div>
      </div>

      <div class="flex-1">
        <TimeZones times={talk.times} />
        <Keywords keywords={talk.keywords} />
        <InvitedBy invitedBy={talk.invitedBy} />
      </div>
    </div>

    {talk.youtubeEmbed && (
      <div class="mt-6 rounded-xl overflow-hidden shadow-lg">
        <div class="relative aspect-video">
          <iframe
            src={talk.youtubeEmbed}
            title="YouTube video player"
            class="absolute inset-0 w-full h-full"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture;"
            referrerpolicy="strict-origin-when-cross-origin"
            allowfullscreen
          />
        </div>
      </div>
    )}
  </div>
</article>